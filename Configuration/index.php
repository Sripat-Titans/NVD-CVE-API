<!DOCTYPE html>
<html>
<head>
    <title> CVE REPORT </title>
    <link rel="stylesheet" type="text/css" href="D:\Project\Assets\css\bootstrap.css">
    <script type="text/javascript" src="D:\Project\Assets\js\bootstrap.js"></script>
    <script type="text/javascript" src="D:\Project\Assets\js\bootstrap.min.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-sm bg-light navbar-light">
    <div class="container-fluid">
        <div class="navbar-header col=lg-10">
            <a class="navbar-brand" href="" style="font-weight: bold; font-size: 24px;"> CVE REPORT </a>
        </div>
    </div>
</nav>
<?php include('db.php');?>
<div class="container">
<div class="row">
        <form method="POST" action="index.php">
            <div class="col-md-3">
                <div class="form-group">
                    <label class="control-label">Year</label>
                    <select class="form-control" name="year">
                        <option>Select</option>
                        <?php
                        $query = "SELECT *
                        FROM cve";
                        $result = mysqli_query($conn, $query) or die ('error');
                        if(mysqli_num_rows($result) > 0){
                            while($row = mysqli_fetch_assoc($result)){?>
                                <option value="<?php echo $row['id']?>"><?php
                                    echo $row['lastModified']?></option>
                            <?php }
                        }
                        ?>
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <label class="control-label" style="padding-top: 40px;"></label>
                <input type="submit" name="submit" class="btn btn-primary" id="submit" value="submit">
            </div>
        </form>
    </div>
    <hr>
    <div class="row">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">CVE ID</th>
                <th scope="col">IDENTIFIER</th>
                <th scope="col">PUBLISHED</th>
                <th scope="col">LAST MODIFIED DATE</th>
                <th scope="col">STATUS</th>
            </tr>
            </thead>
            <tbody>
            <?php
            $limit=10;
            $getQuery="select * from cve";
            $result=mysqli_query($conn, $getQuery);
            $total_rows = mysqli_num_rows($result);
            $total_pages=ceil($total_rows/$limit);
            if(!isset($_GET['id'])){
                $page_number=1;
            }else{
                $page_number=$_GET['id'];
            }
            $initial_page=($page_number-1)* $limit;
            if(!isset($_POST['submit'])){
                $getQuery="SELECT * FROM cve LIMIT $initial_page, $limit";
                getData($getQuery);
            }
            else if(isset($_POST['submit'])&& isset($_POST['lastModified'])){

            }
            ?>
            </tbody>
        </table>
        <?php
        for($page_number=1; $page_number<=$total_pages;$page_number++){
            echo '<a href="index.php?page=' .$page_number . '"
                style="background: #337ab7;
                text-decoration: none;
                margin-right: 1px;
                color: #fff;
                padding: 5px 10px;">'.$page_number . '</a>';
        }
        ?>
    </div>
</div>
</body>
</html>
<?php
function getData($sql){
    include('db.php');
    $result=mysqli_query($conn, $sql);
    if(mysqli_num_rows($result)>0){
        while($row=mysqli_fetch_array($result)){
            echo '<tr>
                <td>'.$row['id'].'</td>
                <td>'.$row['sourceIdentifier'].'</td>
                <td>'.$row['published'].'</td>
                <td>'.$row['lastModified'].'</td>
                <td>'.$row['vulnStatus'].'</td>
            </tr>';
        }
    }
}
?>
